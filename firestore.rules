rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // A function to check if the user is the designated admin
    function isAdmin() {
      return request.auth.token.email == 'ahsan.khan@mitwpu.edu.in';
    }

    // Rules for the journalEntries collection
    match /journalEntries/{entryId} {
      // Users can create their own journal entries
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Users can read their own entries. The admin can read any entry.
      allow read: if (request.auth != null && resource.data.userId == request.auth.uid) || isAdmin();
      
      // The admin can update any entry (to add reports and mark as reviewed)
      allow update: if isAdmin();
      
      // Users cannot delete their entries from the app, only admin can
      allow delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Rules for the questionnaires collection
    match /questionnaires/{questionnaireId} {
      // Users can create their own questionnaire submissions
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Users can read their own submissions. The admin can read any submission.
      allow read: if (request.auth != null && resource.data.userId == request.auth.uid) || isAdmin();
      
      // The admin can update any submission (to add feedback and mark as reviewed)
      allow update: if isAdmin();
      
      // Submissions cannot be deleted
      allow delete: if false;
    }
  }
}
